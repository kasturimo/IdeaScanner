{% extends "base.html" %}
{% block content %}
<div class="card p-4">
  <h3 class="text-center">Welcome, {{ user.name or user.email }}</h3>
  <p class="text-center mb-1">Free analyses left: <strong>{{ free_left }}</strong> (2 total)</p>
  <p class="text-center">Paid credits: <strong>{{ user.credits }}</strong></p>

  {% if need_country %}
    <div class="alert alert-warning mt-3">
      <strong>Set your country</strong> to get the correct price after your free analyses.
      <form method="POST" action="/dashboard" class="mt-3">
        <div class="mb-3">
          <label>Your Country</label>
          <select name="country" class="form-select" required>
            <option value="">-- Select country --</option>
            <option>United States</option><option>United Kingdom</option><option>Canada</option>
            <option>Ireland</option><option>Germany</option><option>France</option><option>Italy</option>
            <option>Spain</option><option>Netherlands</option><option>Belgium</option><option>Sweden</option>
            <option>Denmark</option><option>Norway</option><option>Finland</option><option>Austria</option>
            <option>Switzerland</option><option>Portugal</option><option>Greece</option><option>Poland</option>
            <option>Czechia</option><option>Romania</option><option>Hungary</option><option>Slovakia</option>
            <option>Slovenia</option><option>Croatia</option><option>Estonia</option><option>Latvia</option>
            <option>Lithuania</option><option>Australia</option><option>New Zealand</option>
            <option>India</option><option>Pakistan</option><option>Bangladesh</option><option>Sri Lanka</option>
            <option>Nepal</option><option>Indonesia</option><option>Philippines</option><option>Vietnam</option>
            <option>Thailand</option><option>Malaysia</option><option>Singapore</option><option>Cambodia</option>
            <option>Laos</option><option>Myanmar</option><option>Nigeria</option><option>Kenya</option>
            <option>Ghana</option><option>South Africa</option><option>Egypt</option><option>Ethiopia</option>
            <option>Tanzania</option><option>Uganda</option><option>Algeria</option><option>Morocco</option>
            <option>Tunisia</option><option>Rwanda</option><option>Zambia</option><option>Zimbabwe</option>
            <option>Other</option>
          </select>
        </div>
        <!-- only updating country when empty; submit will also run analysis if an idea is present -->
      </form>
    </div>
  {% endif %}

  <form method="POST" action="/dashboard" class="mt-3">
    <div class="mb-3">
      <label>Enter your idea</label>
      <textarea name="idea" class="form-control" rows="4" required></textarea>
    </div>
    <div class="mb-3">
      <label>Location (market) for this analysis (optional)</label>
      <input type="text" name="location" class="form-control" placeholder="e.g., India, US, EU">
    </div>
    <button type="submit" class="btn btn-primary w-100">Analyze Idea</button>
  </form>

  {% if error %}
    <div class="alert alert-danger mt-3">{{ error }}</div>
  {% endif %}

  {% if analysis %}
    <hr>
    <h5>Viability Score: {{ score if score is not none else "N/A" }}/100</h5>
    <pre style="white-space: pre-wrap;">{{ analysis }}</pre>
    <div class="text-center mt-3">
      <a href="/history" class="btn btn-outline-secondary">View History</a>
    </div>
  {% endif %}

  <div class="mt-4 text-center">
    <p>After your free limit, price for your country ({{ pricing_label }}): <strong>${{ '%.2f' % (price_cents/100) }}</strong></p>
    <a href="/pricing" class="btn btn-outline-primary">Buy 1 Analysis Credit</a>
  </div>
</div>
{% endblock %}



